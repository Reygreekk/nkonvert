<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NKONVERT | ZIP Tool</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root { --red: #E63946; --dark: #00234E; --gray: #F8FAFC; --nav-bg: #001A3A; --green: #27ae60; }
        body { font-family: 'Segoe UI', sans-serif; background: var(--gray); margin: 0; }

        /* Navigation */
        .main-nav { background: var(--nav-bg); padding: 1rem 5%; display: flex; justify-content: center; gap: 20px; box-shadow: 0 4px 15px rgba(0,0,0,0.2); position: sticky; top: 0; z-index: 1000; }
        .main-nav a { color: white; text-decoration: none; font-weight: 600; font-size: 0.9rem; padding: 8px 15px; border-radius: 8px; transition: 0.3s; display: flex; align-items: center; gap: 8px; }
        .main-nav a:hover { background: rgba(230, 57, 70, 0.1); color: var(--red); }
        .main-nav a.active { background: var(--red); color: white; }

        .hero { background: var(--dark); color: white; padding: 40px 20px; text-align: center; }
        .container { max-width: 600px; margin: -30px auto 40px; padding: 0 15px; }
        .card { background: white; border-radius: 24px; padding: 40px; box-shadow: 0 20px 40px rgba(0,0,0,0.1); text-align: center; }

        .file-label { display: flex; flex-direction: column; align-items: center; justify-content: center; background: #FBFCFE; border: 3px dashed #E2E8F0; padding: 40px 20px; border-radius: 20px; cursor: pointer; transition: 0.3s; color: var(--dark); }
        .file-label:hover { border-color: var(--red); background: #FFF5F5; }
        .file-label i { font-size: 3rem; color: var(--red); margin-bottom: 10px; }
        input[type="file"] { display: none; }

        button { background: var(--red); color: white; border: none; padding: 15px; border-radius: 12px; font-weight: bold; width: 100%; margin-top: 20px; cursor: pointer; font-size: 1rem; }
        button:disabled { background: #ccc; }

        .loader { display: none; margin: 20px auto; border: 4px solid #f3f3f3; border-top: 4px solid var(--red); border-radius: 50%; width: 30px; height: 30px; animation: spin 1s linear infinite; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }

        .btn-download { display: none; background: var(--green); color: white; text-decoration: none; padding: 15px; border-radius: 12px; font-weight: bold; margin-top: 15px; width: 100%; box-sizing: border-box; display: none; }
    </style>
</head>
<body>

<nav class="main-nav">
    <a href="/"><i class="fa fa-sync"></i> NKONVERT</a>
    <a href="/boost"><i class="fa fa-lightbulb"></i> BOOST</a>
    <a href="/zip" class="active"><i class="fa fa-file-zipper"></i> ZIP TOOL</a>
</nav>

<div class="hero">
    <h1>Folder to ZIP</h1>
    <p>Compressez vos dossiers en un clic</p>
</div>

<div class="container">
    <div class="card">
        <label class="file-label">
            <i class="fa-solid fa-folder-open"></i>
            <span id="folderName">Choisir un dossier</span>
            <input type="file" id="folderInput" webkitdirectory directory multiple>
        </label>
        
        <button id="zipBtn" onclick="startZipping()">Compresser maintenant</button>
        <div class="loader" id="loader"></div>
        <a href="#" id="dlLink" class="btn-download"><i class="fa fa-download"></i> Télécharger le ZIP</a>
    </div>
</div>

<script>
    const input = document.getElementById('folderInput');
    const label = document.getElementById('folderName');

    input.addEventListener('change', () => {
        if(input.files.length > 0) {
            const folderName = input.files[0].webkitRelativePath.split('/')[0];
            label.innerText = `Dossier : ${folderName} (${input.files.length} fichiers)`;
        }
    });

    async function startZipping() {
        if(input.files.length === 0) return alert("Sélectionnez un dossier !");
        
        const loader = document.getElementById('loader');
        const dl = document.getElementById('dlLink');
        const btn = document.getElementById('zipBtn');

        const formData = new FormData();
        for (const file of input.files) { formData.append('files', file, file.webkitRelativePath); }

        btn.disabled = true; loader.style.display = "block"; dl.style.display = "none";

        try {
            const res = await fetch('/zip_folder', { method: 'POST', body: formData });
            const data = await res.json();
            if(data.success) {
                dl.href = data.download_url;
                dl.style.display = "block";
            } else { alert("Erreur lors de la compression."); }
        } catch(e) { alert("Erreur serveur."); }
        finally { loader.style.display = "none"; btn.disabled = false; }
    }
</script>
</body>
</html>
